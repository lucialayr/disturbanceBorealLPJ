melt(id.vars = c("x", "y")) %>%
filter(59 < y,
y < 60,
2 < x,
x < 0)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
melt(id.vars = c("x", "y")) %>%
filter(59 < y,
y < 60,
2 < x,
x < 0) %>%
mutate(time = row_number())
head(rast)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(59 < y,
y < 60,
2 < x,
x < 0)
head(rast)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(-59 < y,
y > -60,
-2 < x,
x < 0)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time"))
head(rast)
hist(rast$x)
hist(rast$y)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(59 > x,
y < 60,
-2 < y,
x < 0)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time"))
unique(rast$x)
unique(rast$y)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
y < 60,
-2 < y,
x < 0)
ggplot() + geom_line(data = rast, aes(x = time, y = value, color = ))
library(dplyr)
library(reshape2)
library(terra)
library(tidyverse)
ggplot() + geom_line(data = rast, aes(x = time, y = value, color = ))
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time"))
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
y < 60)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
x < 60)
ggplot() + geom_tile(data = rast, aes(x = x, y=y))
ggplot() + geom_tile(data = rast[rast$time == 1, ], aes(x = x, y=y, fill = value))
hist(rast[rast$time == 1, ]$value)
ggplot() + geom_tile(data = rast[rast$time == 1, ], aes(x = x, y=y, fill = value))
ggplot() + geom_line(data = rast, aes(x = time, y = value, group= intersection(x, y) ))
ggplot() + geom_line(data = rast, aes(x = time, y = value, group= interaction(x, y) ))
unique(rast$y)
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
x < 60,
y < 0,
y > -4)
ggplot() + geom_line(data = rast, aes(x = time, y = value, group= interaction(x, y) ))
rast = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
x < 60)
ggplot() + geom_line(data = rast, aes(x = time, y = value, group= interaction(x, y) )) +
geom_smooth(data = rast, aes(x = time, y = value))
rast0 = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_esm-1pct-brch-1000PgC_r1i1p1f2_gn_195001-204912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
x < 60)
library(tidyverse)
library(reshape2)
library(terra)
rast0 = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_esm-1pct-brch-1000PgC_r1i1p1f2_gn_195001-204912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
x < 60)
ggplot() + geom_line(data = rast0, aes(x = time, y = value, group= interaction(x, y) )) +
geom_smooth(data = rast, aes(x = time, y = value))
ggplot() + geom_line(data = rast0, aes(x = time, y = value, group= interaction(x, y) )) +
geom_smooth(data = rast0, aes(x = time, y = value))
library(tidyverse)
library(reshape2)
library(terra)
rast1 = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_205001-214912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
x < 60)
rast0 = terra::rast("Downloads/tas_Amon_UKESM1-0-LL_1pctCO2-cdr_r1i1p1f2_gn_199001-204912.nc") %>%
terra::as.data.frame(xy = TRUE) %>%
mutate(time = row_number()) %>%
melt(id.vars = c("x", "y", "time")) %>%
filter(55 > x,
x < 60)
rast = bind_rows(rast0, rast1)
ggplot() + geom_line(data = rast, aes(x = time, y = value, group= interaction(x, y) )) +
geom_smooth(data = rast, aes(x = time, y = value))
150 *0.94
7*28
512,13/2
512.13/2
= 90 - (45/2)
90 - (45/2)
library(dplyr)
df = read.csv("02_Science/lpjguess/climate_data/hwsd2_nonnan.csv")
df = read.csv("02_Science/lpjguess/climate_data/hwsd2_nonnan.csv", sep = ",")
df = read.csv("02_Science/lpjguess/climate_data/hwsd2_nonnan.csv", sep = " ")
1500000/7
1500000/14
2000000/14
1500000/7
1233000/7
1233000*1.1
(1233000*1.1)
1233000*.1
(1233000*1.12)/7
18*3*3
162/28
?rename_at
library(tidyverse)
?rename_at
?rename_with
relative_uncertainty_map = function(variable = "cpool", equation = FALSE) {
df585 = read.table(paste0("data/raw/", variable, "_ssp585_2100field.out"), header = TRUE) %>%
group_by(Year, Lon, Lat) %>%
summarize(across(everything(), list(mean_585 = mean, sd_585 = sd))) %>%
ungroup() %>%
select(Lon, Lat, Total_mean_585, Total_sd_585)
(p1 = ggplot() + theme_bw() + coord_equal() +
geom_tile(data = df585[df585$Total_mean_585 > 0.1,], aes(x = Lon, y = Lat, fill = Total_mean_585)) +
scico::scale_fill_scico(palette = "lapaz", direction = -1, limits = c(0, 130)))
df126 = read.table(paste0("data/raw/", variable, "_ssp126_2100field.out"), header = TRUE) %>%
group_by(Year, Lon, Lat) %>%
summarize(across(everything(), list(mean_126 = mean, sd_126 = sd))) %>%
ungroup() %>%
select(Lon, Lat, Total_mean_126, Total_sd_126)
(p2 = ggplot() + theme_bw() + coord_equal() +
geom_tile(data = df126[df126$Total_mean_126 > 0.1,], aes(x = Lon, y = Lat, fill = Total_mean_126)) +
scico::scale_fill_scico(palette = "lapaz", direction = -1, limits = c(0, 130)))
df = full_join(df585, df126, by = c("Lon", "Lat")) %>%
mutate(DiffMean = Total_mean_585 - Total_mean_126,
DeltaMean = abs(Total_mean_585 - Total_mean_126),
relative_uncertainty_585 = Total_sd_585/ DeltaMean,
relative_uncertainty_126 = Total_sd_126/ DeltaMean)
write.table(df, "data/processed/uncertainty.out", row.names = F, col.names = T)
(p0 = ggplot() + theme_bw() + coord_equal()  +
geom_tile(data = df, aes(x = Lon, y = Lat, fill = DiffMean)) +
scico::scale_fill_scico(palette = "vik", midpoint = 0, name = "kg/m²"))
if (equation == TRUE) {p0 = p0 + ggtitle(expression(µ[i~SSP585]~-~µ[i~SSP126]))}
colors = c("1 < x < 2" = "black", "x > 2" = "grey")
(p1 = ggplot() + theme_bw() + coord_equal() +
geom_tile(data = df, aes(x = Lon, y = Lat, fill = "x > 2")) +
geom_tile(data = df[df$relative_uncertainty_585 <= 2 & df$relative_uncertainty_585 >= 1,],
aes(x = Lon, y = Lat, fill = "1 < x < 2")) +
scale_fill_manual(values = colors) +
labs(x = "Lon",
y = "Lat",
fill = "kg/m²") +
ggnewscale::new_scale_fill() +
geom_tile(data = df[df$relative_uncertainty_585 <= 1,], aes(x = Lon, y = Lat, fill = relative_uncertainty_585)) +
scico::scale_fill_scico(palette = "lajolla", limits = c(0,1), name = "kg/m²"))
if (equation == TRUE) {p1 = p1 + ggtitle(expression(frac(sigma[i~SSP585],I~µ[i~SSP585]~-~µ[i~SSP126]~I)))}
dfhist = df %>%
melt(measure.vars = c("relative_uncertainty_585", "relative_uncertainty_126"))
(p2 = ggplot() + theme_bw() +
geom_histogram(data = dfhist,
aes(x = value, fill = variable), alpha = .25, bins = 200, color = "darkgrey"))
results = list(p0, p1, p2)
return(results)
}
add_common_layout = function(fontsize) {
theme_bw() %+replace%
theme(axis.title = element_text(size = fontsize),
legend.background = element_rect(fill='transparent', color = NA),
legend.box.background = element_rect(fill='transparent', color = NA),
panel.background = element_rect(fill = "transparent", colour = NA),
plot.background = element_rect(fill = "transparent", colour = NA),
strip.background = element_rect(fill = "transparent", color = NA),
strip.text = element_text(size = fontsize),
text = element_text(size = fontsize))
}
relative_uncertainty_map()[2] + add_common_layout(20)
library(tidyverse)
library(scico)
library(reshape2)
library(cowplot)
library(ggnewscale)
a = b
a = 1
gc()
rm(list = ls())
.rs.restartR()
1188/1.6
1188-742.5
106.20 + 77.95
225 + 280
30*25
4*4*100
2^10
1/2^10
2^-10
2^-10*4
(2^10)*5/4
2^10
2^10
2^10/4
(2^10/4*5)
53000/12
sqrt(1/(100*1.9))
sqrt(1/(100*1.9))*0.1
2^10
1/2^10
4/2^10
0.1*(1/1.5)**(1/1.5)
0.1*(1/2)**(1/2)
0.1*(1/1.5)**(1/1.5)
0.005/0.001
seq(10, 0, -0.001)
length(seq(10, 0, -0.001))
length(seq(1, 0, -0.001))
100*5
length(seq(1, 0, -0.001))/300
length(seq(10, 0, -0.001))/300
length(seq(1, 0, -0.001))/150
length(seq(10, 0, -0.001))/150
length(seq(5, 0, -0.001))/150
481,34 + 80 + 40
481.34 + 80 + 40
42*90
42*90- (360*4)
(42*90- (360*4))/4
1450 + 350 + 940
1450+940
2390-400
2000*12
31/12
3*28
install.packages("igraph")
3*5*8
3*5*8/24
4*28
4*8
3*4
3*4*12
3*4*8
3*4*8/24
library(dplyr)
S = c("ssp585", "picontrol")
D = c("0.04", "0.003333333", "0.1")
Y = c(2015, 2050, 2100, 2500)
2015 %in% Y
library(dplyr)
df <- data.frame(column1 = c(0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0))
head(df)
df %>%
mutate(
column2 = ifelse(column1 == 1, 0, cumsum(column1 == 1)),
column3 = cumsum(column1 == 1)
)
df <- data.frame(column1 = c(0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0))
df %>%
mutate(
group = cumsum(column1 == 1),
column2 = ifelse(column1 == 1, 0, cumsum(column1 == 1) - lag(cumsum(column1 == 1), default = 0)),
column3 = cumsum(column1 == 1)
) %>%
select(-group)
df <- data.frame(column1 = c(0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0))
df %>%
mutate(
group = cumsum(column1 == 1),
column2 = ifelse(column1 == 1, 0, row_number() - first(row_number())[column1 == 1]),
column3 = cumsum(column1 == 1)
) %>%
select(-group)
df <- data.frame(column1 = c(0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0))
df %>%
mutate(
column2 = ifelse(column1 == 1, 0, sequence(rle(column1)$lengths)),
column3 = cumsum(column1 == 1)
)
df <- data.frame(column1 = c(0, 1, 0, 0, 0, 0, 0, 0,  1, 0, 0, 0, 0,  1, 0, 0, 0, 1, 0))
df %>%
mutate(
column2 = ifelse(column1 == 1, 0, sequence(rle(column1)$lengths)),
column3 = cumsum(column1 == 1)
)
df <- data.frame(column1 = c(0, 1, 0, 0, 0, 0, 0, 0,  1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0))
df <- data.frame(column1 = c(0, 1, 0, 0, 0, 0, 0, 0,  1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0))
df %>%
mutate(
column2 = ifelse(column1 == 1, 0, sequence(rle(column1)$lengths)),
column3 = cumsum(column1 == 1)
)
?sequence
?rle
c = c(1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0)
rle(c)
rle(c)$lengths
sequence(rle(c)$lengths)
library(dplyr)
data <- data.frame(
column0 = c("A", "A", "A", "B", "B", "B", "B"),
column1 = c(2010, 2011, 2012, 2013, 2014, 2015, 2016),
column2 = c(1, 0, 0, 1, 0, 1, 0)
)
data <- data %>%
group_by(column0) %>%
mutate(
last_year_with_1 = ifelse(column2 == 1, column1, NA),
last_year_with_1 = zoo::na.locf(last_year_with_1),
column3 = ifelse(column2 == 0, last_year_with_1, column1)
) %>%
ungroup() %>%
select(-last_year_with_1)
data
# Sample data
data <- data.frame(
column0 = c("A", "A", "A", "B", "B", "B", "B"),
column1 = c(2010, 2011, 2012, 2013, 2014, 2015, 2016),
column2 = c(1, 0, 0, 1, 0, 1, 0)
)
result <- data %>%
group_by(column0) %>%
mutate(
last_year_with_1 = ifelse(column2 == 1, column1, NA),
last_year_with_1 = zoo::na.locf(last_year_with_1),
row_id = row_number()  # Add a unique identifier within each group
) %>%
ungroup()
# Join the result back to the original data
final_result <- data %>%
left_join(result %>% select(column0, row_id, last_year_with_1, column2), by = c("column0", "row_id")) %>%
mutate(column3 = ifelse(column2 == 0, last_year_with_1, column1)) %>%
select(-last_year_with_1, -row_id)
# Sample data
data <- data.frame(
column0 = c("A", "A", "A", "B", "B", "B", "B"),
column1 = c(2010, 2011, 2012, 2013, 2014, 2015, 2016),
column2 = c(1, 0, 0, 1, 0, 1, 0)
)
result <- data %>%
group_by(column0) %>%
mutate(
last_year_with_1 = ifelse(column2 == 1, column1, NA),
last_year_with_1 = zoo::na.locf(last_year_with_1),
row_id = row_number()  # Add a unique identifier within each group
) %>%
ungroup()
# Join the result back to the original data
final_result <- data %>%
left_join(result %>% select(column0, row_id, last_year_with_1, column2), by = c("column0", "row_id")) %>%
mutate(column3 = ifelse(column2 == 0, last_year_with_1, column1)) %>%
select(-last_year_with_1, -row_id)
# Sample data
data <- data.frame(
column0 = c("A", "A", "A", "B", "B", "B", "B"),
column1 = c(2010, 2011, 2012, 2013, 2014, 2015, 2016),
column2 = c(1, 0, 0, 1, 0, 1, 0)
)
result <- data %>%
group_by(column0) %>%
mutate(
last_year_with_1 = ifelse(column2 == 1, column1, NA),
last_year_with_1 = zoo::na.locf(last_year_with_1),
row_id = row_number()  # Add a unique identifier within each group
) %>%
ungroup()
# Join the result back to the original data
final_result <- data %>%
left_join(result %>% select(column0, row_id, last_year_with_1, column2), by = c("column0", "row_id")) %>%
mutate(column3 = ifelse(column2 == 0, last_year_with_1, column1)) %>%
select(-last_year_with_1, -row_id)
data <- data %>%
group_by(column0) %>%
mutate(
last_year_with_1 = ifelse(column2 == 1, column1, NA),
last_year_with_1 = zoo::na.locf(last_year_with_1),
column3 = ifelse(column2 == 0, last_year_with_1, column1)
) %>%
ungroup()
data
# Sample data
data <- data.frame(
column0 = c("A", "A", "A", "B", "B", "B", "B"),
column1 = c(2010, 2011, 2012, 2013, 2014, 2015, 2016),
column2 = c(1, 0, 0, 1, 0, 1, 0)
)
result <- data %>%
group_by(column0) %>%
mutate(
last_year_with_1 = max(column1[column2 == 1]),
last_year_with_1 = ifelse(column2 == 0, last_year_with_1, column1)
) %>%
ungroup()
print(result)
scico(30, palette = 'lapaz')
library(scico)
scico(30, palette = 'lapaz')
?scico::scico
scico(30, palette = 'lapaz', end = .8)
scico(3, palette = 'lapaz', end = .8)
scico(4, palette = 'lapaz', end = .8)
library(tidyverse)
library(scico)
library(gganimate)
require(gganimate)
install.packages("gganimate")
install.packages("ggraph")
library(ggraph)
time_step_data = data.frame(Time = c(1, 2, 3),
NodeID = c(1, 1, 2),
X = c(0.5, 0.5, 0.7),
Y = c(0.5, 0.5, 0.3),
Label = c("Node 1", "Node 1", "Node 2"),
Source = c(1, 2, 2),
Target = c(2, 3, 3)
)
static_network <- ggraph(your_network_data, layout = "layout_algorithm") +
geom_edge_link() +
geom_node_point() +
theme_void()
static_network <- ggraph(time_step_data, layout = "layout_algorithm") +
geom_edge_link() +
geom_node_point() +
theme_void()
library(gganimate)
library(ggraph)
time_step_data = data.frame(Time = c(1, 2, 3),
NodeID = c(1, 1, 2),
X = c(0.5, 0.5, 0.7),
Y = c(0.5, 0.5, 0.3),
Label = c("Node 1", "Node 1", "Node 2"),
Source = c(1, 2, 2),
Target = c(2, 3, 3)
)
static_network <- ggraph(time_step_data, layout = "layout_algorithm") +
geom_edge_link() +
geom_node_point() +
theme_void()
install.packages("gifski")
install.packages("gifski")
5*4*3
60/28
install.packages("bookdown")
setwd("~/02_Science/disturbanceBorealLPJ_github")
source("code/vegetation_subset_processed.R")
source("code/albedo_subset_processed.R")
source("code/evapotranspiration_subset_processed.R")
source("code/vegetation_processed_final.R")
source("code/factors_processed_final.R")
source("code/albedo_processed_final.R")
source("code/evapotranspiration_processed_final.R")
source("code/vegetation_plot.R")
final_1B(Climate_Scenarios = c("ssp370" , "ssp585" , "ssp126" , "picontrol"),
Disturbance_Regimes = c("0.04", "0.003333333", "0.1", "0.01"),
variable = "fpc",
year = 2100,
ncore = 4)
source("code/vegetation_plot.R")
source("code/factors_plot.R")
source("code/albedo_plot.R")
source("code/evapotranspiration_plot.R")
session.info(9)
session.info()
sessionInfo()
